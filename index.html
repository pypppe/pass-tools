<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="icon" href="favicon.ico" type="image/x-icon" />
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Password Tools v2.0</title>

  <link href="https://fonts.googleapis.com/css2?family=Fira+Code&display=swap" rel="stylesheet">

  <style>
    :root {
      --bg-main: #0b0b0b;
      --bg-card: #151515;
      --bg-input: #101010;
      --border-soft: #2a2a2a;
      --accent: #00aaff;
      --accent-dim: #008ecc;
      --text-main: #ffffff;
      --text-muted: #a0a0a0;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      padding-bottom: 60px;
      background: var(--bg-main);
      color: var(--text-main);
      font-family: 'Fira Code', monospace;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    header {
      margin-top: 50px;
      font-size: 2.1rem;
      font-weight: 600;
      color: var(--accent);
      text-shadow: 0 0 6px rgba(0,170,255,0.6);
    }

    .section {
      margin-top: 56px;
      width: 90%;
      max-width: 640px;
      background: var(--bg-card);
      border-radius: 14px;
      padding: 28px;
      border: 1px solid var(--border-soft);
    }

    .section-title {
      font-size: 1.35rem;
      margin-bottom: 18px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
    }

    .codeblock {
      background: #000;
      border: 1px solid var(--border-soft);
      border-radius: 10px;
      padding: 14px;
      margin: 16px 0;
      word-break: break-all;
    }

    .button {
      background: var(--accent);
      color: #000;
      border: none;
      border-radius: 8px;
      padding: 9px 18px;
      font-family: inherit;
      cursor: pointer;
    }

    .button:hover { background: var(--accent-dim); }

    .input-number, .input-text {
      background: var(--bg-input);
      color: var(--text-main);
      border: 1px solid var(--border-soft);
      border-radius: 8px;
      padding: 7px 10px;
      font-family: inherit;
    }

    .input-number { width: 70px; }
    .input-text { width: 100%; margin-top: 12px; }

    #historyBox, #managerBox {
      margin-top: 14px;
      border: 1px solid var(--border-soft);
      border-radius: 10px;
      padding: 14px;
      background: rgba(0,0,0,0.4);
      word-break: break-all;
    }

    .blurred {
      filter: blur(7px);
      pointer-events: none;
    }

    /* MODAL */
    .modal {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.75);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 999;
    }

    .modal.active {
      display: flex;
    }

    footer {
      margin-top: 70px;
      color: var(--text-muted);
      font-size: 0.85rem;
    }

#customContextMenu {
    position: absolute;
    background-color: #151515;
    color: #ffffff;
    border-radius: 8px;
    padding: 10px;
    box-shadow: 0px 0px 8px rgba(0, 0, 0, 0.3);
    display: none;
    z-index: 9999;
}

#customContextMenu div {
    padding: 8px 12px;
    cursor: pointer;
    font-family: 'Fira Code', monospace;
}

#customContextMenu div:hover {
    background-color: #333333;
}

  </style>
</head>

<body>

<header>
  Password Tools v2.0
  <div style="font-size: 0.85rem; color: rgba(255, 255, 255, 0.5); margin-top: 8px;">
    <a href="https://ptools.astrarune.com/policies" target="_blank" style="text-decoration: none; color: inherit;">Privacy Policy</a>
    <span style="margin: 0 10px;">•</span>
    <a href="https://ptools.astrarune.com/malwarebytes" target="_blank" style="text-decoration: none; color: inherit;">MalwareBytes</a>
  </div>
</header>

<!-- Generator -->
<div class="section">
  <div class="section-title">Password Generator</div>
  <div style="display:flex; gap:10px;">
    <button class="button" onclick="copyPassword()">Copy</button>
    <input id="lengthInput" class="input-number" type="number" min="12" max="50" value="14">
    <button class="button" onclick="generatePassword()">Generate</button>
  </div>
  <div id="passwordDisplay" class="codeblock">No password generated.</div>
</div>

<!-- History -->
<div class="section">
  <div class="section-title">
    <span>Password History</span>
    <div style="display:flex; gap:8px;">
      <button class="button" onclick="clearPasswords()">Clear</button>
      <button class="button" onclick="downloadPasswords()">Download</button>
    </div>
  </div>

  <div id="blurPrompt">
    <p>Reveal generated passwords?</p>
    <button class="button" onclick="showHistory()">Reveal</button>
  </div>

  <div id="historyBox" class="blurred"></div>
</div>

<!-- Manager -->
<div class="section">
  <div class="section-title">Password Manager</div>
  <input id="customPasswordInput" class="input-text" placeholder="Enter password to save">
  <div style="margin-top:10px; display:flex; gap:10px;">
    <button class="button" onclick="saveCustomPassword()">Save</button>
    <button class="button" onclick="downloadCustomPasswords()">Download</button>
  </div>
  <div id="managerBox"></div>
</div>

<!-- DOWNLOAD MODAL -->
<div id="downloadModal" class="modal">
  <div class="section" style="max-width:420px; margin-top:0;">
    <div class="section-title" style="justify-content:center;">Download Options</div>

    <div style="display:flex; gap:12px; justify-content:center;">
      <button class="button" onclick="confirmDownload('txt')">.TXT file</button>
      <button class="button" onclick="confirmDownload('json')">.JSON file</button>
    </div>

    <div style="margin-top:18px; font-size:0.85rem; color:var(--text-muted);">
      <strong>Instructions:</strong><br><br>
      If prompted to choose an app, select <strong>Notepad</strong>.
    </div>

    <div style="margin-top:16px; text-align:center;">
      <button class="button" onclick="closeDownloadModal()">Cancel</button>
    </div>
  </div>
</div>

<footer>Open-Source · Originally by Stormy45</footer>

<script>
  const passwordDisplay = document.getElementById('passwordDisplay');
  const historyBox = document.getElementById('historyBox');
  const blurPrompt = document.getElementById('blurPrompt');
  const lengthInput = document.getElementById('lengthInput');
  const customInput = document.getElementById('customPasswordInput');
  const managerBox = document.getElementById('managerBox');
  const modal = document.getElementById('downloadModal');

  let passwordHistory = JSON.parse(localStorage.getItem('passwordHistory')) || [];
  let customPasswords = JSON.parse(localStorage.getItem('customPasswords')) || [];
  let pendingDownload = null;

  passwordHistory.forEach(addHistory);
  renderCustomPasswords();

  function generatePassword() {
    const chars = '#!"%@ABCDEFHJ$=-/¬()*&';
    const length = Math.min(50, Math.max(12, lengthInput.value || 14));
    let pwd = '';
    for (let i = 0; i < length; i++) {
      pwd += chars[Math.floor(Math.random() * chars.length)];
    }
    passwordDisplay.textContent = pwd;
    passwordHistory.push(pwd);
    localStorage.setItem('passwordHistory', JSON.stringify(passwordHistory));
    addHistory(pwd);
  }

  function addHistory(pwd) {
    const div = document.createElement('div');
    div.textContent = pwd;
    historyBox.appendChild(div);
  }

  function copyPassword() {
    if (passwordDisplay.textContent !== 'No password generated.') {
      navigator.clipboard.writeText(passwordDisplay.textContent);
      alert('Copied to clipboard');
    }
  }

  function showHistory() {
    historyBox.classList.remove('blurred');
    blurPrompt.style.display = 'none';
  }

  function clearPasswords() {
    passwordHistory = [];
    localStorage.removeItem('passwordHistory');
    historyBox.innerHTML = '';
  }

  function saveCustomPassword() {
    const pwd = customInput.value.trim();
    if (!pwd) return;
    customPasswords.push(pwd);
    localStorage.setItem('customPasswords', JSON.stringify(customPasswords));
    customInput.value = '';
    renderCustomPasswords();
  }

  function renderCustomPasswords() {
    managerBox.innerHTML = '';
    customPasswords.forEach((pwd, i) => {
      const row = document.createElement('div');
      row.style.display = 'flex';
      row.style.justifyContent = 'space-between';
      const span = document.createElement('span');
      span.textContent = pwd;
      const del = document.createElement('button');
      del.textContent = '✕';
      del.className = 'button';
      del.onclick = () => {
        customPasswords.splice(i, 1);
        localStorage.setItem('customPasswords', JSON.stringify(customPasswords));
        renderCustomPasswords();
      };
      row.append(span, del);
      managerBox.appendChild(row);
    });
  }

  function downloadPasswords() {
    if (!passwordHistory.length) return alert('No passwords to download');
    pendingDownload = { data: passwordHistory, name: 'GeneratedPasswords' };
    modal.classList.add('active');
  }

  function downloadCustomPasswords() {
    if (!customPasswords.length) return alert('No saved passwords');
    pendingDownload = { data: customPasswords, name: 'SavedPasswords' };
    modal.classList.add('active');
  }

  function closeDownloadModal() {
    modal.classList.remove('active');
    pendingDownload = null;
  }

  function confirmDownload(type) {
    if (!pendingDownload) return;
    const content = type === 'txt'
      ? pendingDownload.data.join('\n')
      : JSON.stringify(pendingDownload.data, null, 2);

    const blob = new Blob([content], { type: 'text/plain' });
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = `${pendingDownload.name}.${type}`;
    a.click();
    closeDownloadModal();
  }

document.addEventListener('DOMContentLoaded', function () {
    const customMenu = document.createElement('div');
    customMenu.id = 'customContextMenu';
    customMenu.innerHTML = `
        <div>Password Tools v2.0, by Astrarune</div>
    `;
    document.body.appendChild(customMenu);

    document.addEventListener('contextmenu', function (e) {
        e.preventDefault(); 
        showCustomMenu(e.clientX, e.clientY);
    });

    function showCustomMenu(x, y) {
        customMenu.style.left = `${x}px`;
        customMenu.style.top = `${y}px`;
        customMenu.style.display = 'block';
    }

    document.addEventListener('click', function () {
        customMenu.style.display = 'none';
    });
});

</script>

</body>
</html>
